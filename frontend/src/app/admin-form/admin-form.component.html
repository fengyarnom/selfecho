<section class="admin-page py-6 space-y-4">
  <div class="flex items-center justify-between text-sm text-slate-600">
    <nav class="breadcrumbs">
      <a routerLink="/" class="link">Home</a>
      <span class="sep">/</span>
      <a routerLink="/admin/posts" class="link">Admin</a>
      <span class="sep">/</span>
      <a routerLink="/admin/posts" class="link">Posts</a>
      <span class="sep">/</span>
      <span class="muted">{{ editingId ? 'Edit' : 'New' }}</span>
    </nav>
    <a routerLink="/admin" class="link font-semibold text-[#3273dc]">返回列表</a>
  </div>

  <form class="form" (ngSubmit)="save()" #articleForm="ngForm">
    <div class="field">
      <label>标题 *</label>
      <input name="title" [(ngModel)]="form.title" required />
    </div>
    <div class="field">
      <label>类型</label>
      <select name="type" [(ngModel)]="form.type">
        <option value="post">文章</option>
        <option value="memo">备忘录</option>
      </select>
    </div>
    <div class="field">
      <label>Slug</label>
      <div class="slug-row">
        <input name="slug" [(ngModel)]="form.slug" placeholder="可留空，自动拼音化" />
        <div class="slug-actions">
          <button
            type="button"
            class="btn ghost"
            [disabled]="slugGenerating"
            (click)="generateSlug('llm')"
          >
            {{ slugGenerating ? '生成中...' : 'LLM 生成' }}
          </button>
          <button
            type="button"
            class="btn ghost"
            [disabled]="slugGenerating"
            (click)="generateSlug('pinyin')"
          >
            拼音
          </button>
        </div>
      </div>
      <p class="muted" *ngIf="slugMessage">{{ slugMessage }}</p>
    </div>
    <div class="field">
      <label>归档名称</label>
      <select name="archiveSelect" [(ngModel)]="selectedArchive" (change)="onArchiveChange($event)">
        <option value="">新建</option>
        <option *ngFor="let a of archives" [value]="a">{{ a }}</option>
      </select>
      <input name="archive" [(ngModel)]="form.archive" placeholder="" />
    </div>
    <div class="field">
      <label>内容</label>
      <div class="editor-wrap">
        <div class="editor-toolbar">
          <button type="button" class="editor-btn" [class.active]="editorView === 'rich'" (click)="setEditorView('rich')">
            编辑
          </button>
          <button type="button" class="editor-btn" [class.active]="editorView === 'source'" (click)="setEditorView('source')">
            源码
          </button>
          <button type="button" class="editor-btn" [class.active]="editorView === 'preview'" (click)="setEditorView('preview')">
            预览
          </button>
          <span class="editor-sep"></span>
          <ng-container *ngIf="editorView === 'rich'">
            <button type="button" class="editor-btn" [class.active]="editorActive('heading', { level: 1 })" (click)="toggleHeading(1)">
              H1
            </button>
            <button type="button" class="editor-btn" [class.active]="editorActive('heading', { level: 2 })" (click)="toggleHeading(2)">
              H2
            </button>
            <button type="button" class="editor-btn" [class.active]="editorActive('heading', { level: 3 })" (click)="toggleHeading(3)">
              H3
            </button>
            <span class="editor-sep"></span>
            <button type="button" class="editor-btn" [class.active]="editorActive('bold')" (click)="toggleBold()">B</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('italic')" (click)="toggleItalic()">I</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('strike')" (click)="toggleStrike()">S</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('code')" (click)="toggleInlineCode()">`</button>
            <span class="editor-sep"></span>
            <button type="button" class="editor-btn" [class.active]="editorActive('bulletList')" (click)="toggleBulletList()">•</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('orderedList')" (click)="toggleOrderedList()">1.</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('blockquote')" (click)="toggleBlockquote()">❝</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('codeBlock')" (click)="toggleCodeBlock()">```</button>
            <button type="button" class="editor-btn" (click)="insertHorizontalRule()">—</button>
          </ng-container>
        </div>
        <div class="editor-surface" [class.disabled]="saving">
          <div #editorHost class="tiptap-host article-body" [class.hidden]="editorView !== 'rich'"></div>
          <textarea
            *ngIf="editorView === 'source'"
            class="source-editor"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="form.bodyMd"
            (ngModelChange)="onMarkdownChange($event)"
          ></textarea>
          <div *ngIf="editorView === 'preview'" class="markdown-preview article-body" [innerHTML]="markdownHtml"></div>
        </div>
      </div>
    </div>

    <div class="actions-bar">
      <span class="error" *ngIf="error">{{ error }}</span>
      <div class="spacer"></div>
      <label class="status-control">
        <span class="status-label">状态</span>
        <select name="status" [(ngModel)]="form.status" class="status-select">
          <option value="draft">草稿</option>
          <option value="published">已发布</option>
        </select>
      </label>
      <button type="submit" class="btn primary" [disabled]="saving">
        {{ saving ? '保存中...' : '保存' }}
      </button>
    </div>
  </form>
</section>

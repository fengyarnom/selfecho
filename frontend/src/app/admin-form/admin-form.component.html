<section class="admin-page py-6 space-y-4">
  <div class="flex items-center justify-between text-sm text-slate-600">
    <nav class="breadcrumbs">
      <a routerLink="/" class="link">Home</a>
      <span class="sep">/</span>
      <a routerLink="/admin/posts" class="link">Admin</a>
      <span class="sep">/</span>
      <a routerLink="/admin/posts" class="link">Posts</a>
      <span class="sep">/</span>
      <span class="muted">{{ editingId ? 'Edit' : 'New' }}</span>
    </nav>
    <a routerLink="/admin" class="link font-semibold text-[#3273dc]">è¿”å›åˆ—è¡¨</a>
  </div>

  <form class="form" (ngSubmit)="save()" #articleForm="ngForm">
    <div class="field">
      <label>æ ‡é¢˜ *</label>
      <input name="title" [(ngModel)]="form.title" required />
    </div>
    <div class="field">
      <label>ç±»å‹</label>
      <select name="type" [(ngModel)]="form.type">
        <option value="post">æ–‡ç« </option>
        <option value="memo">å¤‡å¿˜å½•</option>
      </select>
    </div>
    <div class="field">
      <label>Slug</label>
      <div class="slug-row">
        <input name="slug" [(ngModel)]="form.slug" placeholder="å¯ç•™ç©ºï¼Œè‡ªåŠ¨æ‹¼éŸ³åŒ–" />
        <div class="slug-actions">
          <button
            type="button"
            class="btn ghost"
            [disabled]="slugGenerating"
            (click)="generateSlug('llm')"
          >
            {{ slugGenerating ? 'ç”Ÿæˆä¸­...' : 'LLM ç”Ÿæˆ' }}
          </button>
          <button
            type="button"
            class="btn ghost"
            [disabled]="slugGenerating"
            (click)="generateSlug('pinyin')"
          >
            æ‹¼éŸ³
          </button>
        </div>
      </div>
      <p class="muted" *ngIf="slugMessage">{{ slugMessage }}</p>
    </div>
    <div class="field">
      <label>å½’æ¡£åç§°</label>
      <select name="archiveSelect" [(ngModel)]="selectedArchive" (change)="onArchiveChange($event)">
        <option value="">æ–°å»º</option>
        <option *ngFor="let a of archives" [value]="a">{{ a }}</option>
      </select>
      <input name="archive" [(ngModel)]="form.archive" placeholder="" />
    </div>
    <div class="field">
      <label>å†…å®¹</label>
      <div class="editor-wrap">
        <div class="editor-toolbar">
          <div class="editor-toolbar-row editor-toolbar-modes">
            <button type="button" class="mode-btn" [class.active]="editorView === 'rich'" (click)="setEditorView('rich')" title="ç¼–è¾‘" aria-label="ç¼–è¾‘">
              <span class="mode-icon">ğŸ“</span>
            </button>
            <button type="button" class="mode-btn" [class.active]="editorView === 'source'" (click)="setEditorView('source')" title="æºç " aria-label="æºç ">
              <span class="mode-icon code">&lt;/&gt;</span>
            </button>
            <button type="button" class="mode-btn" [class.active]="editorView === 'preview'" (click)="setEditorView('preview')" title="é¢„è§ˆ" aria-label="é¢„è§ˆ">
              <span class="mode-icon">ğŸ‘</span>
            </button>
          </div>
          <div class="editor-toolbar-row editor-toolbar-actions" *ngIf="editorView === 'rich'">
            <button type="button" class="editor-btn" [class.active]="editorActive('heading', { level: 1 })" (click)="toggleHeading(1)">
              H1
            </button>
            <button type="button" class="editor-btn" [class.active]="editorActive('heading', { level: 2 })" (click)="toggleHeading(2)">
              H2
            </button>
            <button type="button" class="editor-btn" [class.active]="editorActive('heading', { level: 3 })" (click)="toggleHeading(3)">
              H3
            </button>
            <span class="editor-sep"></span>
            <button type="button" class="editor-btn" [class.active]="editorActive('bold')" (click)="toggleBold()">B</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('italic')" (click)="toggleItalic()">I</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('strike')" (click)="toggleStrike()">S</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('code')" (click)="toggleInlineCode()">`</button>
            <span class="editor-sep"></span>
            <button type="button" class="editor-btn" [class.active]="editorActive('bulletList')" (click)="toggleBulletList()">â€¢</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('orderedList')" (click)="toggleOrderedList()">1.</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('blockquote')" (click)="toggleBlockquote()">â</button>
            <button type="button" class="editor-btn" [class.active]="editorActive('codeBlock')" (click)="toggleCodeBlock()">```</button>
            <button type="button" class="editor-btn" (click)="insertHorizontalRule()">â€”</button>
          </div>
        </div>
        <div class="editor-surface" [class.disabled]="saving">
          <div #editorHost class="tiptap-host article-body" [class.hidden]="editorView !== 'rich'"></div>
          <textarea
            *ngIf="editorView === 'source'"
            class="source-editor"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="form.bodyMd"
            (ngModelChange)="onMarkdownChange($event)"
          ></textarea>
          <div *ngIf="editorView === 'preview'" class="markdown-preview article-body" [innerHTML]="markdownHtml"></div>
        </div>
      </div>
    </div>

    <div class="actions-bar">
      <span class="error" *ngIf="error">{{ error }}</span>
      <div class="spacer"></div>
      <label class="status-control">
        <select name="status" [(ngModel)]="form.status" class="status-select">
          <option value="draft">è‰ç¨¿</option>
          <option value="published">å·²å‘å¸ƒ</option>
        </select>
      </label>
      <button type="submit" class="btn primary" [disabled]="saving">
        {{ saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}
      </button>
    </div>
  </form>
</section>
